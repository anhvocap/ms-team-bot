(()=>{"use strict";var e={64:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.nonce=void 0,t.nonce={},r(n(163),t),r(n(896),t)},896:function(e,t,n){var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.MyProfileTab=void 0;const r=n(698);let s=class{};s=o([(0,r.PreventIframe)("/myProfileTab/index.html")],s),t.MyProfileTab=s},163:function(e,t,n){var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.MyWorkTab=void 0;const r=n(698);let s=class{};s=o([(0,r.PreventIframe)("/myWorkTab/index.html"),(0,r.PreventIframe)("/myWorkTab/config.html"),(0,r.PreventIframe)("/myWorkTab/remove.html")],s),t.MyWorkTab=s},836:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(860),s=n(599),i=n(147),a=r.Router();a.get("/status",(function(e,t,n){console.log("- WEB_INFO:",process.env.WEB_INFO),t.json({status:!0,message:`${i.name} execute get success`,version:i.version,web_info:process.env.WEB_INFO}),n()})),a.post("/token",(function(e,t){return o(this,void 0,void 0,(function*(){try{const n=e.header("app_secret");if(!n)throw new Error("application secret key is required");if(n!==process.env.APP_SECRET)throw new Error("application secret key is invalid");const o=yield s.default.getAccessToken();t.json({status:!0,data:o})}catch(e){t.send({status:400,message:e.message})}}))})),t.default=a},967:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(860),s=n(685),i=n(17),a=n(470),c=n(698),u=n(974),p=n(455),l=n(836),d=n(567),f=n(167),m=u("msteams");m("Initializing Microsoft Teams Express hosted App..."),n(142).config();const y=n(64),v=r(),h=process.env.port||process.env.PORT||3007;v.use(r.json({verify:(e,t,n,o)=>{e.rawBody=n.toString()}})),v.use(r.urlencoded({extended:!0})),v.set("views",i.join(__dirname,"/")),v.use(a("tiny")),v.use(p()),v.use("/scripts",r.static(i.join(__dirname,"web/scripts"))),v.use("/assets",r.static(i.join(__dirname,"web/assets"))),v.use((0,c.MsTeamsApiRouter)(y)),v.use((0,c.MsTeamsPageRouter)({root:i.join(__dirname,"web/"),components:y})),v.use("/v1/api",l.default),v.use("/",r.static(i.join(__dirname,"web/"),{index:"index.html"})),v.get("/exchangeSsoTokenForOboToken",((e,t)=>o(void 0,void 0,void 0,(function*(){m("getting access token for Microsoft Graph...");const n=process.env.TAB_APP_ID,o=process.env.TAB_APP_SECRET,r=e.query.ssoToken,s=`https://login.microsoftonline.com/${(0,d.default)(r).tid}/oauth2/v2.0/token`,i={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",client_id:n,client_secret:o,assertion:r,requested_token_use:"on_behalf_of",scope:process.env.TAB_APP_SCOPES},a=Object.keys(i).map(((e,t)=>`${e}=${encodeURIComponent(i[e])}`)).join("&"),c={accept:"application/json","content-type":"application/x-www-form-urlencoded"};try{const e=yield f.default.post(s,a,{headers:c});200===e.status?t.status(200).send(e.data):"invalid_grant"===e.data.error||"interaction_required"===e.data.error?t.status(403).json({error:"consent_required"}):t.status(500).json({error:"Could not exchange access token"})}catch(e){t.status(400).json({error:`Unknown error: ${e}`})}})))),v.set("port",h),s.createServer(v).listen(h,(()=>{m(`Server running on ${h}`)}))},599:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(167),s=n(941),i={headers:{"Content-Type":"multipart/form-data"}};t.default={getAccessToken:function(){return o(this,void 0,void 0,(function*(){try{const e=new s;e.append("grant_type","client_credentials"),e.append("client_id","f50bebee-b729-43fd-b01b-a3da4bc77250"),e.append("client_secret","HKq8Q~2MDu42ARyeocQXzJzkvhUnLlf7cU46lcno"),e.append("scope","https://graph.microsoft.com/.default");const t=yield r.default.post("https://login.microsoftonline.com/f055188a-0916-40fd-aeed-2ba499834c94/oauth2/v2.0/token",e,i),{token_type:n,expires_in:o,not_before:a,expires_on:c,resource:u,access_token:p}=t.data;return{token_type:n,expires_in:o,access_token:p}}catch(e){throw console.log("ERROR: getAccessToken has error !"),e}}))}}},167:e=>{e.exports=require("axios")},455:e=>{e.exports=require("compression")},974:e=>{e.exports=require("debug")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},698:e=>{e.exports=require("express-msteams-host")},941:e=>{e.exports=require("form-data")},567:e=>{e.exports=require("jwt-decode")},470:e=>{e.exports=require("morgan")},685:e=>{e.exports=require("http")},17:e=>{e.exports=require("path")},147:e=>{e.exports=JSON.parse('{"name":"teamappprofile","version":"1.0.4","description":"Generated by yoteams, https://aka.ms/yoteams","author":"voduyanh","email":"voduyanh1984@gmail.com","scripts":{"start":"node dist/server.js","build":"gulp build","manifest":"gulp manifest","debug":"gulp serve --debug","lint":"eslint ./src --ext .js,.jsx,.ts,.tsx"},"dependencies":{"@fluentui/react-components":"^9.18.6","@fluentui/react-northstar":"~0.62.0","@fluentui/web-components":"^2.5.12","@microsoft/microsoft-graph-client":"^3.0.5","@microsoft/teams-js":"^2.0.0","axios":"^0.27.2","botbuilder":"~4.16.0","botbuilder-dialogs":"~4.16.0","compression":"1.7.4","debug":"~4.3.4","dotenv":"^16.0.0","express":"~4.18.1","express-msteams-host":"1.9.1","express-session":"~1.17.2","jwt-decode":"^3.1.2","morgan":"~1.10.0","msteams-react-base-component":"^4.0.1","react":"^16.8.6","react-dom":"^16.8.6"},"devDependencies":{"@types/debug":"4.1.7","@types/express":"^4.17.13","@types/express-session":"~1.17.4","@types/morgan":"~1.9.3","@types/react":"16.8.10","@types/react-dom":"^16.9.7","@typescript-eslint/eslint-plugin":"^5.22.0","@typescript-eslint/parser":"^5.22.0","browser-sync":"^2.26.5","eslint":"^8.15.0","eslint-config-standard":"^17.0.0","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^6.0.0","eslint-plugin-react":"^7.22.0","eslint-plugin-react-hooks":"^4.2.0","eslint-webpack-plugin":"^3.0.1","fancy-log":"^2.0.0","file-loader":"~6.2.0","fork-ts-checker-webpack-plugin":"~7.2.11","gulp":"4.0.2","ts-loader":"~9.3.0","typescript":"~4.6.4","typestyle":"~2.3.0","vinyl":"2.2.1","webpack":"^5.72.0","webpack-node-externals":"^3.0.0","yargs":"^17.5.1","yoteams-build-core":"^1.8.0","yoteams-deploy":"^1.4.0"},"browserslist":["> 1%","last 2 versions","Firefox ESR"],"engines":{"node":">=12"}}')}},t={};!function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(967)})();
//# sourceMappingURL=server.js.map